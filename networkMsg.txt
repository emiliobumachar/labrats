Proposal for what a network package might look like:
Encrypted and signed using the shared key in the safe file, but let's do that last.
'atmID='+ ascii digits of random number between zero and 999999999999, generated by the ATM on startup, and always used in messages from or to that atm. This will help the bank deal with multiple atms.
A space.
On hold to be revoked: 'msgCounter='+ascii digits of unbounded sequential number, starting at zero, incremented when the same sender sends a new message. To prevent replay attacks and reordering attacks. All messages with counter lower than highest counter ever received are ignored.
A space.
Bank only: 'replyTo='+ascii digits of a copy of the sequential number of the atm message it's replying to. 
A space.
Bank only: 'bankAns='+ 'y' or 'n', meaning yes or no to the atm solicitation.
A space.
Atm only:'action='+'n','d','w', or 'g', depending on the action solicited
A space.
Atm only: 'atmAns'= 'y' or 'n', meaning yes or no to whether the atm's error checking is clean. Messages marked 'no' will help the bank print the error.
A space. 
'$=' + amount or balance. Applicable to all atm messages except 'g'. Only applicable to bank's answer to 'g'
A space.
Atm only: 'account=' + account name.
A space.
'pad='+Padding to match a predetermined total message length. This is to prevent attackers from knowing the operation or account from the message length.

Examples, padding ommitted:
Atm message:
atmID=123456789012 msgCounter=0 action=n atmAns=y $=23.98 account=Fulano.de-tal.1992
Bank answer:
atmID=123456789012 msgCounter=0 replyTo=0 bankAns=y

Atm message:
atmID=123456789012 msgCounter=1 action=w atmAns=n $=09.00 account=Fulano.de-tal.1992
Bank does not answer because atmAns is no.


Atm message:
atmID=123456789012 msgCounter=2 action=w atmAns=y $=99.00 account=Fulano.de-tal.1992
Bank answer:
atmID=123456789012 msgCounter=1 replyTo=2 bankAns=n

Atm message:
atmID=123456789012 msgCounter=2 action=w atmAns=y $=09.00 account=Fulano.de-tal.1992
Bank does not answer because msgCounter is lower than expected.

Atm message:
atmID=123456789012 msgCounter=200 action=w atmAns=y $=09.00 account=Fulano.de-tal.1992
Bank answer:
atmID=123456789012 msgCounter=2 replyTo=200 bankAns=y
